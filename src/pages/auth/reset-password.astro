---
import AuthLayout from '@/layouts/AuthLayout.astro';
import AuthForm from '@/features/auth/components/AuthForm.vue';
import BaseTypography from '@/shared/components/BaseTypography.vue';

// Check if user is already authenticated and redirect
const { user } = Astro.locals;
if (user) {
  return Astro.redirect('/dj/dashboard');
}
---

<AuthLayout
  title="Reset Password"
  subtitle="Enter your email address and we'll send you a link to reset your password"
>
  <!-- Password Reset Form -->
  <div id="reset-form-container">
    <AuthForm mode="reset-password" client:load />
  </div>

  <!-- Instructions -->
  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
    <div class="flex">
      <svg
        class="w-5 h-5 text-blue-400 mt-0.5"
        fill="currentColor"
        viewBox="0 0 20 20"
      >
        <path
          fill-rule="evenodd"
          d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
          clip-rule="evenodd"></path>
      </svg>
      <div class="ml-3">
        <BaseTypography variant="body-small" color="primary" client:load>
          <strong>How it works:</strong> We'll email you a secure link to reset your
          password. Check your spam folder if you don't see it in your inbox within
          a few minutes.
        </BaseTypography>
      </div>
    </div>
  </div>

  <!-- Navigation Links -->
  <div class="text-center space-y-3">
    <BaseTypography variant="body-small" color="muted" client:load>
      Remember your password?
      <a
        href="/auth/login"
        class="font-medium text-purple-600 hover:text-purple-500 transition-colors"
      >
        Sign in here
      </a>
    </BaseTypography>

    <BaseTypography variant="body-small" color="muted" client:load>
      Don't have an account?
      <a
        href="/auth/register"
        class="font-medium text-purple-600 hover:text-purple-500 transition-colors"
      >
        Create one here
      </a>
    </BaseTypography>
  </div>

  <!-- Footer slot with additional links -->
  <div slot="footer" class="space-y-2">
    <BaseTypography variant="caption" color="muted" client:load>
      <a
        href="/"
        class="font-medium text-gray-600 hover:text-gray-500 transition-colors"
      >
        ‚Üê Back to home
      </a>
    </BaseTypography>
  </div>
</AuthLayout>

<script>
  // Handle reset password form submission
  document.addEventListener('DOMContentLoaded', () => {
    const formContainer = document.getElementById('reset-form-container');

    if (formContainer) {
      formContainer.addEventListener('submit', async (event) => {
        // The AuthForm component will handle the API call for reset-password mode
        // through its emit('submit') event which will call the API endpoint
        console.log('Reset password form submitted');
      });
    }
  });
</script>
